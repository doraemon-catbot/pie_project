# pie_project

파이류 매대 점유율 분석 도구 (오리온 + 경쟁사)

## 개요

매대 사진에서 파이류 제품을 검출하고, 브랜드별 점유율(Facing/면적)을 대시보드로 시각화합니다.

## 대상 브랜드

### 오리온 (9개 브랜드)
- 초코파이
- 참붕어빵
- 신카스타드
- 마켓오리얼브라우니
- 마켓오다쿠아즈
- 케익오뜨
- 후레쉬베리
- 쉘위
- 쌀카스테라

### 롯데 (5개 브랜드)
- ZERO
- 롯데초코파이
- 롯데카스타드
- 몽쉘
- 찰떡파이

### 해태크라운 (7개 브랜드)
- 롱스
- 빅파이
- 오예스
- 쿠쿠다스케이크
- 크라운딸기파이
- 크라운쵸코파이
- 크림블

**총 17개 브랜드, 48개 맛(SKU)**

## 주요 기능

- 매대 사진 업로드 → 상품 자동 검출 (DETR)
- 파이류 브랜드 분류 (MobileNetV3) - 맛(SKU) 단위 학습, 브랜드 단위 집계
- **Facing 점유율**: 제품 개수 기반
- **면적 점유율**: 박스 크기 기반
- **회사별 점유율**: 컬러 바로 직관적 표시 (오리온/롯데/해태크라운/기타)
- **미분류 제품**: "기타" 회사로 점유율에 포함
- Gradio 기반 대시보드 (Soft 테마)

## 폴더 구조 (학습 데이터)

```
data/train/
└── 파이/                    ← 카테고리
    ├── 오리온/              ← 회사
    │   ├── 초코파이/        ← 브랜드
    │   │   ├── 초코파이_정/  ← 맛(SKU)
    │   │   └── 초코파이_바나나/
    │   └── 후레쉬베리/
    │       ├── 후레쉬베리_기본/
    │       └── 후레쉬베리_멜론/
    ├── 롯데/
    │   ├── 몽쉘/
    │   └── ...
    └── 해태크라운/
        ├── 오예스/
        └── ...
```

## 프로젝트 구조

```
pie_project/
├── README.md
├── requirements.txt
├── train.py              # 분류기 학습 스크립트
├── app/
│   ├── main.py           # Gradio 대시보드
│   ├── detection.py      # DETR 검출기
│   ├── classification.py # 파이 분류기
│   └── analysis.py       # 점유율 계산
├── models/
│   └── classifier/       # 학습된 분류 모델
├── data/
│   └── train/파이/       # 학습 데이터 (카테고리/회사/브랜드/맛)
└── docs/
    ├── PRD.md            # 제품 요구사항 문서
    └── project_history.md # 프로젝트 히스토리
```

## 설치

```bash
pip install -r requirements.txt
```

## 학습

```bash
python train.py
```

## 실행

```bash
python app/main.py
# 브라우저에서 http://127.0.0.1:7860 접속
```

## 기술 스택

- 검출: DETR ResNet-50 (SKU110K)
- 분류: MobileNetV3 Small
- UI: Gradio
- 프레임워크: PyTorch, Transformers

## 핵심 인사이트

> **"학습은 시각적 단위(맛/SKU)로, 결과는 비즈니스 단위(브랜드)로"**

같은 브랜드라도 맛에 따라 패키징이 다르므로 맛 단위로 학습하고, 최종 결과는 브랜드 단위로 집계합니다.

## 관련 프로젝트

- `pingu`: 57개 브랜드 점유율 분석 (보류)
- `facing-analyzer`: 초코파이 facing 카운터
- `crop_Project`: 학습 데이터 crop 도구
