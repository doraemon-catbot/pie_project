# PRD: 파이류 점유율 분석 시스템

## 1. 개요

### 1.1 프로젝트명
**pie_project** - 파이류 매대 점유율 분석 도구 (오리온 + 경쟁사)

### 1.2 목적
매대 사진에서 파이류 제품(오리온, 롯데, 해태크라운)을 검출하고, 브랜드별 점유율(Facing/면적)을 대시보드로 시각화한다.

### 1.3 배경
- 기존 pingu 프로젝트는 57개 브랜드를 분류하여 정확도가 낮았음
- 파이류로 범위를 축소하여 분류 정확도 향상
- 경쟁사 제품도 함께 분류하여 시장 점유율 분석 가능
- **핵심 인사이트**: "학습은 시각적 단위(맛/SKU)로, 결과는 비즈니스 단위(브랜드)로"

### 1.4 확장 계획
파이류 분류기를 시작으로, 향후 카테고리별로 확장 예정:
- 1단계: **파이류** (현재) - 17개 브랜드, 48개 맛(SKU)
- 2단계: 스낵류
- 3단계: 비스킷류
- 4단계: 바류
- 이후: 전체 카테고리 통합

## 2. 대상 브랜드 (17개 브랜드, 48개 맛)

### 2.1 오리온 (9개 브랜드)

| 번호 | 브랜드명 | 맛(SKU) 수 |
|------|----------|-----------|
| 1 | 초코파이 | 정, 바나나, 수박 등 |
| 2 | 참붕어빵 | 기본, 호떡 |
| 3 | 신카스타드 | 기본 |
| 4 | 마켓오리얼브라우니 | 기본, 말차 |
| 5 | 마켓오다쿠아즈 | 베리 등 |
| 6 | 케익오뜨 | 쇼콜라, 치즈 |
| 7 | 후레쉬베리 | 기본, 멜론, 요거트베리 |
| 8 | 쉘위 | 클래식, 카카오 |
| 9 | 쌀카스테라 | 기본 |

### 2.2 롯데 (5개 브랜드)

| 번호 | 브랜드명 |
|------|----------|
| 1 | ZERO |
| 2 | 롯데초코파이 |
| 3 | 롯데카스타드 |
| 4 | 몽쉘 |
| 5 | 찰떡파이 |

### 2.3 해태크라운 (7개 브랜드)

| 번호 | 브랜드명 |
|------|----------|
| 1 | 롱스 |
| 2 | 빅파이 |
| 3 | 오예스 |
| 4 | 쿠쿠다스케이크 |
| 5 | 크라운딸기파이 |
| 6 | 크라운쵸코파이 |
| 7 | 크림블 |

## 3. 데이터 구조

```
data/train/
└── 파이/                    ← 카테고리
    ├── 오리온/              ← 회사
    │   ├── 초코파이/        ← 브랜드
    │   │   ├── 초코파이_정/  ← 맛(SKU) - 학습 단위
    │   │   └── 초코파이_바나나/
    │   └── ...
    ├── 롯데/
    │   ├── 몽쉘/
    │   │   └── 몽쉘_기본/
    │   └── ...
    └── 해태크라운/
        ├── 오예스/
        │   └── 오예스_기본/
        └── ...
```

**학습 방식:**
- 맛(SKU) 폴더 단위로 클래스 학습
- 분류 결과는 브랜드 단위로 집계

## 4. 기능 요구사항

### 4.1 이미지 검출
- 매대 사진 업로드 시 개별 상품 자동 검출
- DETR ResNet-50 (SKU110K) 모델 사용
- 중첩 박스 제거 (Nested Box Suppression)

### 4.2 파이 브랜드 분류
- 검출된 상품을 21개 브랜드로 분류
- MobileNetV3 Small 기반 분류기
- 맛(SKU) 단위 학습 → 브랜드 단위 집계

### 4.3 점유율 계산
- **Facing 점유율**: 브랜드별 검출 개수 비율
- **면적 점유율**: 브랜드별 bbox 면적 비율
- 오리온 vs 경쟁사 비교 분석

### 4.4 대시보드
- 업로드된 매대 사진에 검출 결과 시각화
- 각 박스에 브랜드명 표시
- Facing + 면적 점유율 동시 표시
- 브랜드별 점유율 파이 차트
- Gradio 기반 웹 UI

## 5. 비기능 요구사항

### 5.1 성능
- 이미지 1장 처리 시간: 10초 이내 (CPU 기준)
- 분류 정확도 목표: 90% 이상

### 5.2 사용성
- 단일 페이지 대시보드
- 드래그 앤 드롭 이미지 업로드
- 결과 즉시 확인 가능

## 6. 기술 스택

| 구분 | 기술 |
|------|------|
| 검출 모델 | DETR ResNet-50 (isalia99/detr-resnet-50-sku110k) |
| 분류 모델 | MobileNetV3 Small |
| 프레임워크 | PyTorch, Transformers |
| UI | Gradio |
| 언어 | Python 3.10+ |

## 7. 마일스톤

| 단계 | 작업 | 상태 |
|------|------|------|
| 1 | 프로젝트 구조 및 문서 작성 | 완료 |
| 2 | 오리온 파이 브랜드 학습 데이터 수집 | 완료 |
| 3 | 1차 분류기 학습 (오리온 7개 브랜드) | 완료 (99.64%) |
| 4 | 검출 + 분류 파이프라인 구현 | 완료 |
| 5 | Gradio 대시보드 구현 | 완료 |
| 6 | 타사 브랜드 데이터 수집 (롯데, 해태크라운) | 완료 |
| 7 | 2차 분류기 학습 (48개 맛, 3사 통합) | 완료 (97.49%) |
| 8 | UI 개선 (컬러 바, 테이블 개선) | 완료 |
| 9 | 점유율 계산 개선 (미분류→기타 포함) | 완료 |
| 10 | 기타 폴더 추가 및 학습 | 대기 |
| 11 | 스낵류 확장 | 미정 |
| 12 | 비스킷류 확장 | 미정 |

## 8. 관련 프로젝트

- **pingu**: 57개 브랜드 점유율 분석 (보류)
- **facing-analyzer**: 초코파이 facing 카운터 (DETR 검출기 검증용)
- **crop_Project**: 학습 데이터 crop 도구 (51,074장 생성 완료)
